# ‚öôÔ∏è Config System Konzept

## √úberblick

Ein umfassendes Konfigurationssystem f√ºr AuditMySite, das verschiedene Umgebungen (Development, CI/CD, Production) und Use Cases unterst√ºtzt.

## üìÅ Config-Dateien

### 1. Projektlevel Config-Dateien

```
# Precedence (h√∂chste Priorit√§t zuerst):
1. audit.config.js          # JavaScript config mit komplexer Logik
2. audit.config.json        # JSON config f√ºr einfache Setups
3. .auditrc                 # YAML/JSON minimale config
4. package.json auditConfig # Embedded config
```

### 2. User-level Config (optional)

```
~/.auditmysiterc            # Global user preferences
~/.config/auditmysite/      # XDG config directory
```

## üõ†Ô∏è Config Schema

### audit.config.js (Vollversion)

```javascript
module.exports = {
  // Basis-Konfiguration
  extends: ['@auditmysite/config-react', '@auditmysite/config-ecommerce'],
  
  // Multi-Environment Support
  environments: {
    development: {
      server: {
        type: 'dev-server',
        port: 3000,
        host: 'localhost',
        startCommand: 'npm run dev',
        healthCheck: '/health',
        timeout: 30000
      },
      standards: {
        wcag: 'WCAG2AA',
        strictMode: false,
        ignoreRules: ['color-contrast-enhanced'] // Dev kann laxer sein
      },
      performance: {
        budgets: 'development',
        collectMetrics: ['LCP', 'CLS', 'FCP'],
        ignoreThresholds: true // Dev-Server ist langsamer
      },
      output: {
        format: 'terminal',
        interactive: true,
        detailedFixes: true,
        realTimeUpdates: true
      }
    },
    
    ci: {
      server: {
        type: 'static',
        buildCommand: 'npm run build',
        serveCommand: 'npm run preview',
        port: 4173
      },
      standards: {
        wcag: 'WCAG2AA',
        strictMode: true,
        failOnWarnings: false
      },
      performance: {
        budgets: 'production',
        enforceThresholds: true
      },
      output: {
        format: 'junit',
        exitOnFail: true,
        reporters: ['console', 'github-actions']
      }
    },
    
    production: {
      sitemapUrl: 'https://mysite.com/sitemap.xml',
      standards: {
        wcag: 'WCAG2AAA',
        strictMode: true,
        failOnWarnings: true
      },
      monitoring: {
        enabled: true,
        schedule: 'daily',
        alerts: ['slack', 'email']
      }
    }
  },
  
  // Framework-spezifische Einstellungen
  framework: {
    type: 'react', // auto-detected oder manual
    router: 'react-router', // f√ºr Route Discovery
    buildTool: 'vite', // f√ºr Dev-Server Detection
    
    // Custom Route Discovery
    routes: {
      patterns: [
        'src/pages/**/*.{jsx,tsx}', // File-based routing
        'src/components/routes/**'
      ],
      exclude: ['**/[...slug].js', '**/_*.js'], // Dynamic/private routes
      include: [
        '/',
        '/about',
        '/products/*',
        {
          path: '/dashboard/*',
          auth: {
            type: 'session',
            loginUrl: '/login',
            testUser: { email: 'test@example.com', password: 'test123' }
          }
        }
      ]
    }
  },
  
  // Testing-Verhalten
  testing: {
    parallel: {
      enabled: true,
      maxConcurrent: 3,
      retries: 2
    },
    
    screenshots: {
      enabled: true,
      onErrors: true,
      responsive: ['desktop', 'mobile']
    },
    
    coverage: {
      // Welche Tests sollen durchgef√ºhrt werden
      accessibility: true,
      performance: true,
      seo: false,
      security: false,
      
      // Custom Test Suites
      custom: [
        './tests/accessibility/custom-rules.js'
      ]
    }
  },
  
  // Output & Reporting
  reporting: {
    outputDir: './reports',
    formats: ['html', 'json'],
    
    // Custom Templates
    templates: {
      html: './config/report-template.hbs',
      email: './config/email-template.mjml'
    },
    
    // Branding
    branding: {
      logo: './assets/company-logo.png',
      colors: {
        primary: '#007acc',
        success: '#28a745',
        warning: '#ffc107',
        error: '#dc3545'
      },
      company: 'Acme Corp',
      footer: 'Generated by AuditMySite for Acme Corp'
    }
  },
  
  // Integrations
  integrations: {
    git: {
      enabled: true,
      compareWith: 'main',
      commitReports: false,
      prComments: true
    },
    
    slack: {
      webhook: process.env.SLACK_WEBHOOK,
      channel: '#accessibility',
      onlyOnFail: true
    },
    
    jira: {
      host: 'company.atlassian.net',
      project: 'WEB',
      issueType: 'Bug',
      autoCreate: false // Nur bei kritischen Errors
    }
  },
  
  // Advanced Settings
  advanced: {
    // Browser Settings
    browser: {
      viewport: { width: 1920, height: 1080 },
      userAgent: 'custom-audit-bot/1.0',
      cookies: [
        { name: 'consent', value: 'accepted', domain: '.mysite.com' }
      ]
    },
    
    // Network Simulation
    network: {
      throttle: '3g', // f√ºr Performance-Tests
      offline: false
    },
    
    // Custom Wait Conditions
    waitConditions: [
      'networkidle0',
      { selector: '.loading-spinner', hidden: true },
      { function: 'window.appReady === true' }
    ]
  }
}
```

### audit.config.json (Einfache Version)

```json
{
  "extends": "@auditmysite/config-nextjs",
  "development": {
    "server": {
      "port": 3000,
      "startCommand": "npm run dev"
    },
    "routes": ["/", "/about", "/contact"]
  },
  "ci": {
    "buildCommand": "npm run build",
    "output": {
      "format": "junit"
    }
  },
  "standards": {
    "wcag": "WCAG2AA"
  },
  "performance": {
    "budgets": "ecommerce"
  }
}
```

### package.json Integration

```json
{
  "name": "my-app",
  "scripts": {
    "audit:dev": "auditmysite --env development",
    "audit:ci": "auditmysite --env ci",
    "audit:prod": "auditmysite --env production"
  },
  "auditConfig": {
    "development": {
      "routes": ["/", "/products"]
    }
  }
}
```

## üîß Config-Vererbung & Presets

### Preset-System

```bash
npm install @auditmysite/config-react
npm install @auditmysite/config-nextjs
npm install @auditmysite/config-ecommerce
npm install @auditmysite/config-wordpress
```

```javascript
// @auditmysite/config-react
module.exports = {
  framework: {
    type: 'react',
    router: 'react-router'
  },
  testing: {
    coverage: {
      accessibility: true,
      performance: true
    }
  },
  development: {
    server: {
      type: 'dev-server',
      port: 3000
    }
  }
}
```

### Config Merging

```javascript
// Merge-Priorit√§t:
// 1. CLI arguments (--max-pages 5)
// 2. Environment-specific config (development.routes)  
// 3. Base config (routes)
// 4. Extended configs (extends: ['preset1', 'preset2'])
// 5. Default values
```

## üöÄ CLI Integration

```bash
# Environment ausw√§hlen
auditmysite --env development
auditmysite --env ci
auditmysite --env production

# Config-Datei spezifizieren
auditmysite --config ./custom-audit.config.js

# Config validieren
auditmysite --validate-config

# Config generieren (interaktiv)
auditmysite --init
auditmysite --init --preset react
auditmysite --init --preset ecommerce

# Dry-run (zeigt finale Config)
auditmysite --dry-run --env ci
```

## üìä Config-Management Features

### 1. Interactive Config Creator

```bash
auditmysite --init

? What type of project is this? (Use arrow keys)
‚ùØ React SPA
  Vue.js Application  
  Next.js Website
  Angular App
  Static HTML Site
  WordPress Site
  Custom Setup

? What's your development server? (Use arrow keys)
‚ùØ Vite (http://localhost:3000)
  Webpack Dev Server (http://localhost:8080)
  Next.js Dev (http://localhost:3000)
  Custom URL
  
? Which pages should be tested? (Press space to select)
‚ùØ‚óâ Homepage (/)
 ‚óØ About Page (/about)
 ‚óâ Contact Page (/contact)
 ‚óØ Auto-discover from router
 ‚óØ Manual route list

? Performance testing level? (Use arrow keys)  
  Basic (LCP, CLS)
‚ùØ Standard (+ FCP, TTFB)
  Complete (+ INP, custom metrics)
  Disabled

‚ú® Generated audit.config.js
‚ú® Added npm scripts to package.json
üöÄ Run 'npm run audit:dev' to test your development server!
```

### 2. Config Validation

```javascript
// Automatische Validierung beim Start
const validation = {
  errors: [
    'server.port must be a number between 1-65535',
    'standards.wcag must be one of: WCAG2A, WCAG2AA, WCAG2AAA'
  ],
  warnings: [
    'performance.budgets "custom" specified but no custom values provided',
    'routes array is empty - no pages will be tested'
  ]
}
```

### 3. Config Migration

```bash
# Upgrade config when new versions introduce breaking changes
auditmysite --migrate-config --from 1.4 --to 2.0

‚ú® Migrated audit.config.js:
‚Ä¢ Renamed 'pa11yStandard' to 'standards.wcag'  
‚Ä¢ Moved 'outputFormat' to 'output.format'
‚Ä¢ Added new 'performance.budgets' section
‚Ä¢ Backup saved as audit.config.js.backup
```

## üí° Zus√§tzliche Features

### Schema Validation mit JSON Schema

```javascript
// Vollst√§ndiges JSON Schema f√ºr IDE-Unterst√ºtzung
{
  "$schema": "https://schemas.auditmysite.com/config/v2.json",
  // ...config hier
}
```

### VS Code Integration

```json
// .vscode/settings.json
{
  "json.schemas": [
    {
      "fileMatch": ["audit.config.json", ".auditrc"],
      "url": "https://schemas.auditmysite.com/config/v2.json"
    }
  ]
}
```

### Environment Variable Support

```javascript
module.exports = {
  ci: {
    slack: {
      webhook: process.env.SLACK_WEBHOOK, // Aus .env
      channel: process.env.SLACK_CHANNEL || '#accessibility'
    }
  },
  
  // Template-Variablen
  reporting: {
    company: '${COMPANY_NAME}',
    footer: 'Report for ${COMPANY_NAME} - ${DATE}'
  }
}
```

---

**Das Config-System w√ºrde AuditMySite extrem flexibel machen und verschiedenste Workflows unterst√ºtzen, w√§hrend es trotzdem einfach zu verwenden bleibt.**
